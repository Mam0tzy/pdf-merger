<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Combine & Merge PDF Files Online - Free PDF Merger Tool</title>
    <meta name="description" content="Easily merge multiple PDF files into one document with our free, secure, and fast online PDF combiner. Drag, drop, reorder, and merge PDFs instantly. No registration needed.">
    <meta name="keywords" content="pdf merger, combine pdf, merge pdf, pdf joiner, pdf combiner, merge pdf online, free pdf merger, online pdf tool, combine documents, pdf tool, secure pdf merge, fast pdf merge">
    
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:title" content="Combine & Merge PDF Files Online - Free PDF Merger">
    <meta property="og:description" content="Quickly merge multiple PDF files into one with our easy-to-use online tool. Free, secure, and fast.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://pdf-merger-97wa.onrender.com/static/og-image.png">
    <meta property="og:url" content="https://pdf-merger-97wa.onrender.com">
    <meta property="og:site_name" content="PDF Merger">
    
    <!-- Additional SEO Meta Tags -->
    <meta name="robots" content="index, follow">
    <meta name="author" content="Matteo Moors">
    <link rel="canonical" href="https://pdf-merger-97wa.onrender.com">
    <link rel="icon" href="/static/favicon.ico">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <style>
        body {
            background-color: #f8f9fa;
        }
        .card {
            margin-top: 2rem;
        }
        .drag-area {
            border: 2px dashed #adb5bd;
            border-radius: .375rem;
            padding: 3rem;
            text-align: center;
            background-color: #fff;
            transition: background-color 0.2s ease-in-out;
        }
        .drag-area.dragover {
            background-color: #e9ecef;
            border-color: #0d6efd;
        }
        .pdf-list {
            margin-top: 1.5rem;
            max-height: 400px; /* Adjust as needed */
            overflow-y: auto;
        }
        .pdf-item {
            cursor: grab;
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
            align-items: center;
        }
        .pdf-item:active {
            cursor: grabbing;
            background-color: #e9ecef;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
         .pdf-item.dragging {
            opacity: 0.5;
            background: #f8f9fa;
        }
        .drag-handle {
            cursor: grab;
            color: #6c757d;
            font-size: 1.2rem;
            line-height: 1;
            margin-right: 0.75rem;
            padding: 0.5rem 0; /* Increase clickable area */
        }
        .drag-handle:active {
             cursor: grabbing;
        }
        .pdf-item-number {
            background-color: #0d6efd;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
            font-size: 0.9rem;
            font-weight: bold;
        }
        .pdf-item-name {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .spinner-border {
            display: none; /* Hidden by default */
            width: 1rem;
            height: 1rem;
            margin-left: 0.5rem;
        }
        footer {
            margin-top: 3rem;
            padding: 1.5rem 0;
            text-align: center;
            font-size: 0.9rem;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="text-center my-4">
            <h1><i class="bi bi-file-earmark-pdf-fill text-danger"></i> PDF Merger</h1>
            <p class="lead text-muted">Combine multiple PDF documents into a single file easily.</p>
        </header>

        <main>
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">1. Upload Your PDFs</h5>
                    <section class="upload-section">
                        <div class="drag-area" id="dropZone">
                            <i class="bi bi-cloud-arrow-up-fill fs-1 text-secondary mb-3"></i>
                            <p class="mb-2">Drag and drop PDF files here or</p>
                            <button type="button" class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                                <i class="bi bi-folder2-open"></i> Select Files
                            </button>
                            <input type="file" id="fileInput" multiple accept=".pdf" style="display: none">
                            <p class="text-muted mt-2"><small>Max file size: 16MB per file</small></p>
                        </div>
                    </section>
                </div>
            </div>

            <div class="card shadow-sm">
                <div class="card-body">
                     <h5 class="card-title">2. Arrange Files</h5>
                     <p class="text-muted"><small>Drag and drop to reorder the files before merging.</small></p>
                    <section class="file-list-section">
                         <ul class="list-group pdf-list" id="pdfList">
                            <!-- PDF items will be added here by JavaScript -->
                             <li class="list-group-item text-center text-muted" id="noFilesMessage">No files uploaded yet.</li>
                         </ul>
                    </section>
                </div>
            </div>

            <div class="card shadow-sm">
                 <div class="card-body">
                    <h5 class="card-title">3. Merge and Download</h5>
                    <section class="merge-section">
                         <div class="mb-3">
                            <label for="outputFilename" class="form-label">Output Filename:</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="outputFilename" placeholder="merged_file" aria-label="Output filename">
                                <span class="input-group-text">.pdf</span>
                            </div>
                        </div>
                        <button type="button" class="btn btn-success w-100" onclick="mergePDFs()" id="mergeButton" disabled>
                            <i class="bi bi-file-earmark-zip-fill"></i> Merge PDFs
                            <div class="spinner-border text-light spinner-border-sm" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </button>
                        <div id="errorMessage" class="alert alert-danger mt-3 d-none" role="alert"></div>
                    </section>
                 </div>
            </div>
        </main>

        <footer>
            <p>&copy; 2024 PDF Merger Tool. Use this free tool to combine your PDF files.</p>
        </footer>
    </div>

    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org", // Use https
        "@type": "WebApplication",
        "name": "PDF Merger - Combine PDF Files Online",
        "description": "Free online tool to securely merge multiple PDF files into a single document. Features drag-and-drop uploading and file reordering.",
        "applicationCategory": "Utilities",
        "operatingSystem": "Any", // Corrected casing
        "url": "https://your-domain.com", // TODO: Update with your actual domain
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "featureList": [
            "Merge multiple PDF files",
            "Combine PDF documents",
            "Drag and drop PDF upload",
            "Reorder PDF files before merging",
            "Secure PDF processing",
            "Free to use",
            "No registration required",
            "Instant PDF download"
        ],
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://your-domain.com", // Link to the tool itself
            "query-input": "required name=search_term_string"
        },
        "creator": {
            "@type": "Organization", // Or "Person"
            "name": "Your Name or Company Name" // TODO: Update Author
        }
    }
    </script>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>

    <script>
        let pdfs = []; // Array to hold File objects
        let draggedItem = null; // Track the item being dragged

        const fileInput = document.getElementById('fileInput');
        const dropZone = document.getElementById('dropZone');
        const pdfList = document.getElementById('pdfList');
        const outputFilenameInput = document.getElementById('outputFilename');
        const mergeButton = document.getElementById('mergeButton');
        const errorMessageDiv = document.getElementById('errorMessage');
        const noFilesMessage = document.getElementById('noFilesMessage');
        const mergeSpinner = mergeButton.querySelector('.spinner-border');


        // --- Event Listeners ---
        fileInput.addEventListener('change', handleFileSelect);
        dropZone.addEventListener('dragover', handleDragOver);
        dropZone.addEventListener('dragleave', handleDragLeave);
        dropZone.addEventListener('drop', handleFileDrop);

        // --- File Handling ---
        function handleFileSelect(e) {
            addFiles(e.target.files);
             // Clear the input so the same file can be selected again if removed
             e.target.value = null;
        }

        function handleFileDrop(e) {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            addFiles(e.dataTransfer.files);
        }

        function addFiles(files) {
            const newFiles = Array.from(files).filter(file =>
                file.type === 'application/pdf' && !pdfs.some(existing => existing.name === file.name && existing.size === file.size) // Prevent duplicates
            );
            pdfs.push(...newFiles);
            updateUI();
        }

        function removePDF(index) {
            pdfs.splice(index, 1);
            updateUI();
        }

        // --- Drag and Drop for Reordering ---
        function handleDragStart(e) {
             // Use the closest list item as the dragged item
            draggedItem = e.target.closest('.pdf-item');
             if (!draggedItem) return; // Exit if drag didn't start on a draggable element

            // Use a slight delay to allow the browser to render the drag image
            setTimeout(() => {
                 if (draggedItem) draggedItem.classList.add('dragging');
            }, 0);
            e.dataTransfer.effectAllowed = 'move';
            // Set data (even if empty) is required for Firefox drag-and-drop to work correctly
            e.dataTransfer.setData('text/plain', '');
        }


        function handleDragEnd(e) {
            if (draggedItem) {
                 draggedItem.classList.remove('dragging');
            }
             // Clean up potential lingering dragover styles on list items
             document.querySelectorAll('.pdf-item.drag-over').forEach(item => item.classList.remove('drag-over'));
            draggedItem = null;
        }

        function handleDragOverItem(e) {
            e.preventDefault();
             const targetItem = e.target.closest('.pdf-item');
             if (!targetItem || targetItem === draggedItem) return;

            // Remove previous drag-over styles
            document.querySelectorAll('.pdf-item.drag-over').forEach(item => item.classList.remove('drag-over'));
             // Add style to the item being dragged over
            targetItem.classList.add('drag-over'); // You might need CSS for .drag-over

            e.dataTransfer.dropEffect = 'move';
        }

         function handleDragLeaveItem(e) {
            const targetItem = e.target.closest('.pdf-item');
             if (targetItem) {
                 targetItem.classList.remove('drag-over');
             }
        }


        function handleDropOnItem(e) {
            e.preventDefault();
             const targetItem = e.target.closest('.pdf-item');
            if (!targetItem || targetItem === draggedItem) {
                 if (draggedItem) draggedItem.classList.remove('dragging'); // Ensure dragging class is removed on invalid drop
                return;
            }

             // Remove drag-over style
             targetItem.classList.remove('drag-over');

            const allItems = [...pdfList.querySelectorAll('.pdf-item')];
            const fromIndex = allItems.indexOf(draggedItem);
            const toIndex = allItems.indexOf(targetItem);

            if (fromIndex !== -1 && toIndex !== -1) {
                // Reorder the pdfs array
                const [movedItem] = pdfs.splice(fromIndex, 1);
                pdfs.splice(toIndex, 0, movedItem);

                // Update the UI immediately to reflect the change
                updateUI();
            } else {
                 console.error("Could not find dragged or target item index.");
                 if (draggedItem) draggedItem.classList.remove('dragging');
            }
        }

        // --- UI Update ---
        function updateUI() {
            pdfList.innerHTML = ''; // Clear the list

             if (pdfs.length === 0) {
                 pdfList.appendChild(noFilesMessage); // Show the message
                 noFilesMessage.style.display = 'list-item';
                 mergeButton.disabled = true;
             } else {
                 noFilesMessage.style.display = 'none'; // Hide the message
                pdfs.forEach((file, index) => {
                    const li = document.createElement('li');
                    li.className = 'list-group-item pdf-item d-flex justify-content-between align-items-center';
                    li.draggable = true;

                    li.innerHTML = `
                        <div class="d-flex align-items-center flex-grow-1 overflow-hidden">
                             <span class="drag-handle me-2" title="Drag to reorder">⋮⋮</span>
                            <span class="pdf-item-number me-2">${index + 1}</span>
                            <span class="pdf-item-name flex-grow-1" title="${file.name}">${file.name}</span>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="removePDF(${index})" title="Remove file">
                            <i class="bi bi-trash"></i>
                        </button>
                    `;

                    // Attach drag listeners to the list item itself
                    li.addEventListener('dragstart', handleDragStart);
                    li.addEventListener('dragend', handleDragEnd);
                    li.addEventListener('dragover', handleDragOverItem);
                     li.addEventListener('dragleave', handleDragLeaveItem);
                    li.addEventListener('drop', handleDropOnItem);

                    pdfList.appendChild(li);
                });
                mergeButton.disabled = false;
             }
            errorMessageDiv.classList.add('d-none'); // Hide error on UI update
        }


        // --- Drag Area Styling ---
        function handleDragOver(e) {
            e.preventDefault(); // Necessary to allow dropping
            dropZone.classList.add('dragover');
            e.dataTransfer.dropEffect = 'copy'; // Indicate copying files
        }

        function handleDragLeave(e) {
            // Check if the leave event is transitioning outside the drop zone entirely
             if (!dropZone.contains(e.relatedTarget)) {
                dropZone.classList.remove('dragover');
            }
        }

        // --- Merging Logic ---
        async function mergePDFs() {
            if (pdfs.length < 1) {
                showError("Please upload at least one PDF file.");
                return;
            }

            mergeButton.disabled = true;
            mergeSpinner.style.display = 'inline-block'; // Show spinner
            errorMessageDiv.classList.add('d-none'); // Hide previous errors

            const formData = new FormData();
            pdfs.forEach((file, index) => {
                // Send files in the current order
                formData.append('files[]', file, file.name);
            });

            let outputName = outputFilenameInput.value.trim() || 'merged_file';
            // Ensure it doesn't end with .pdf before appending it
            outputName = outputName.replace(/\.pdf$/i, '');
            formData.append('output_filename', outputName);


            try {
                const response = await fetch('/merge', {
                    method: 'POST',
                    body: formData,
                    // 'Content-Type': 'multipart/form-data' is set automatically by browser with FormData
                });

                if (response.ok) {
                    // Success - Trigger download
                    const blob = await response.blob();
                    const downloadUrl = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = downloadUrl;
                    // Get filename from Content-Disposition header or fallback
                    const disposition = response.headers.get('Content-Disposition');
                    let filename = outputName + '.pdf'; // Default
                    if (disposition && disposition.indexOf('attachment') !== -1) {
                        const filenameRegex = /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;
                        const matches = filenameRegex.exec(disposition);
                        if (matches != null && matches[1]) {
                        filename = matches[1].replace(/['"]/g, '');
                        }
                    }
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(downloadUrl);
                    a.remove();

                    // Optionally reset after successful merge
                    pdfs = [];
                    outputFilenameInput.value = '';
                    updateUI();

                } else {
                    // Handle server-side errors
                    const errorData = await response.json();
                    showError(`Merge failed: ${errorData.error || response.statusText}`);
                }
            } catch (error) {
                console.error('Error during fetch:', error);
                showError(`An error occurred: ${error.message}. Please check the console.`);
            } finally {
                mergeButton.disabled = (pdfs.length === 0); // Re-enable only if there are files
                mergeSpinner.style.display = 'none'; // Hide spinner
            }
        }

        function showError(message) {
            errorMessageDiv.textContent = message;
            errorMessageDiv.classList.remove('d-none');
        }

        // --- Initial UI Setup ---
         updateUI(); // Initial call to set up the list (shows "No files" message)

    </script>
</body>
</html> 
